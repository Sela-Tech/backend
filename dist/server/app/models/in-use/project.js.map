{"version":3,"sources":["../../../../../app/models/in-use/project.js"],"names":["_","require","mongoose","autoPopulate","mongoosePaginate","Save","Notifications","Proposal","Documents","Evidence","Milestone","Task","Transaction","Schema","ObjectId","Types","schemaOptions","minimize","id","toJSON","getters","virtuals","versionKey","retainKeyOrder","toObject","usePushEach","autoIndex","process","env","NODE_ENV","strict","projectStructure","name","type","String","required","max","activated","Boolean","default","tags","Array","description","startDate","Date","avatarKey","endDate","location","ref","autopopulate","select","goal","Number","implementationBudget","observationBudget","raised","documents","transactions","proposals","stakeholders","user","information","agreed","status","enum","owner","numOfevaluators","createdOn","now","updatedOn","test","projectSchemaOptions","extend","collection","ProjectSchema","pre","next","done","update","$set","post","remove","project","_id","console","log","plugin","module","exports","model"],"mappings":"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","file":"project.js","sourcesContent":["var _ = require(\"underscore\");\n// var moment = require(\"moment\");\nvar mongoose = require(\"mongoose\");\nvar autoPopulate = require(\"mongoose-autopopulate\");\nconst mongoosePaginate = require('mongoose-paginate');\n\n//import related models\nconst Save = require('./save_project');\nconst Notifications = require('./notification');\nconst Proposal = require('./proposal');\nconst Documents = require(\"./document\");\nconst Evidence = require(\"./evidence\");\nconst Milestone = require(\"./milestone\");\nconst Task = require(\"./task\");\nconst Transaction = require(\"./transaction\");\n\nvar Schema = mongoose.Schema;\nvar ObjectId = Schema.Types.ObjectId;\n\nvar schemaOptions = {\n  minimize: false,\n  id: false,\n  toJSON: {\n    getters: true,\n    virtuals: true,\n    minimize: false,\n    versionKey: false,\n    retainKeyOrder: true\n  },\n  toObject: {\n    getters: true,\n    virtuals: true,\n    minimize: false,\n    versionKey: false,\n    retainKeyOrder: true\n  },\n  usePushEach : true,\n  autoIndex: process.env.NODE_ENV === \"development\",\n  strict: process.env.NODE_ENV !== \"development\"\n};\n\nvar projectStructure = {\n  name: {\n    type: String,\n    required: true,\n    max: 100\n  },\n  activated: {\n    type: Boolean,\n    default: true\n  },\n  tags: {\n    type: Array,\n    default: []\n  },\n  description: {\n    type: String,\n    required: true,\n    max: 100\n  },\n  startDate: {\n    type: Date,\n    required: true\n  },\n  \"project-avatar\": {\n    type: String,\n    default: \"http://placehold.it/200\"\n  },\n  avatarKey: {\n    type: String\n  },\n  endDate: {\n    type: Date,\n    default: null\n  },\n  location: {\n    type: ObjectId,\n    ref: \"Location\",\n    autopopulate: { select: \"name lat lng _id\" }\n  },\n  goal: {\n    type: Number,\n    default: 0\n  },\n  implementationBudget:{\n    type:Number,\n    default:0\n  },\n  observationBudget:{\n    type:Number,\n    default:0\n  },\n  raised: {\n    type: Number,\n    default: 0\n  },\n  documents: [{ type: ObjectId, ref: \"Document\", autopopulate: true }],\n  transactions: [{ type: ObjectId, ref: \"Transaction\", autopopulate: true }],\n  proposals: [{ type: ObjectId, ref: \"Proposal\", autopopulate: { select: \"proposalName milestones proposedBy assignedTo status\" }}],\n  stakeholders: [\n    {\n      user: {\n        information: {\n          type: ObjectId,\n          ref: \"User\",\n          required: true,\n          autopopulate: {\n            select:\n              \"isFunder isContractor isEvaluator reputationScore firstName lastName email _id organization profilePhoto \"\n          }\n        },\n        agreed: {\n          type: Boolean,\n          default: false\n        },\n        status: {\n          type: String,\n          enum: ['PENDING', 'ACCEPTED', 'DECLINED'],\n          default: \"PENDING\"\n        }\n      }\n    }\n  ],\n  owner: {\n    type: ObjectId,\n    ref: \"User\",\n    autopopulate: {\n      select:\n        \"organization firstName reputationScore lastName _id activated profilePhoto email socket isFunder isContractor isEvaluator\"\n    }\n  },\n  status: {\n    type: String,\n    enum: [\"PROPOSED\",\"DORMANT\", \"STARTED\", \"TERMINATED\", \"COMPLETED\"],\n    default: \"PROPOSED\"\n  },\n  numOfevaluators: {\n    type: Number,\n    default: 20\n  },\n  createdOn: {\n    type: Date,\n    default: Date.now()\n  },\n  updatedOn: {\n    type: Date,\n    default: Date.now()\n  }\n};\n\nif (process.env.NODE_ENV === \"development\") {\n  projectStructure.test = {\n    type: Boolean,\n    default: true\n  };\n}\n\nvar projectSchemaOptions = _.extend({}, schemaOptions, {\n  collection: \"projects\"\n});\n\nvar ProjectSchema = new Schema(projectStructure, projectSchemaOptions);\n\nProjectSchema.pre(\"save\", true, function (next, done) {\n  next();\n\n  this.updatedOn = new Date();\n\n  done();\n});\n\nProjectSchema.pre(\"update\", true, function (next, done) {\n  next();\n\n  this.update(\n    {},\n    {\n      $set: {\n        updatedOn: new Date()\n      }\n    }\n  );\n\n  done();\n});\n\nProjectSchema.post('remove', async function (next) {\n\n  try {\n    //all methods below are for development purpose, project never really gets deleted from the platform\n    //comment all methods below before pushing to production\n    await Save.remove({ project: this._id });\n    await Proposal.remove({ project: this._id });\n    await Notifications.remove({ project: this._id });\n    await Documents.remove({ project: this._id });\n    await Evidence.remove({ project: this._id });\n    await Milestone.remove({ project: this._id });\n    await Task.remove({ project: this._id });\n    await Transaction.remove({ project: this._id });\n    next();\n  } catch (error) {\n    // next(error);\n    console.log(error)\n  }\n})\n\nProjectSchema.plugin(autoPopulate);\nProjectSchema.plugin(mongoosePaginate);\nmodule.exports = mongoose.model(\"Project\", ProjectSchema);\n"]}