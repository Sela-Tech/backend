{"version":3,"sources":["../../../middleware/validateRole.js"],"names":["require","AccessControl","grantsObject","Helper","helper","ac","Role","role","setRole","bind","validateRole","req","getRole","roles","res","next","permission","setGrants","readAny","granted","status","json","message","module","exports"],"mappings":";;;;;;eAA0BA,QAAQ,eAAR,C;IAAlBC,a,YAAAA,a;;AAER,IAAMC,eAAeF,QAAQ,8BAAR,CAArB;AACA,IAAMG,SAASH,QAAQ,sBAAR,CAAf;;AAGA,IAAMI,SAAS,IAAID,MAAJ,EAAf;AACA,IAAME,KAAK,IAAIJ,aAAJ,CAAkBC,YAAlB,CAAX;;AAEA;AACE;;AAEA;;IAEII,I;AACF,oBAAa;AAAA;;AACT,aAAKC,IAAL,GAAU,EAAV;;AAEA,aAAKC,OAAL,GAAa,KAAKA,OAAL,CAAaC,IAAb,CAAkB,IAAlB,CAAb;AACA,aAAKC,YAAL,GAAkB,KAAKA,YAAL,CAAkBD,IAAlB,CAAuB,IAAvB,CAAlB;AACH;;;;gCAEOE,G,EAAI;AACT,iBAAKJ,IAAL,GAAYH,OAAOQ,OAAP,CAAeD,IAAIE,KAAnB,CAAZ;AACF;;;qCAEYF,G,EAAKG,G,EAAKC,I,EAAK;AACxB,iBAAKP,OAAL,CAAaG,GAAb;;AAEC,gBAAMK,aAAaX,GAAGY,SAAH,CAAa,KAAKV,IAAlB,EAAwBW,OAAxB,CAAgC,yBAAhC,CAAnB;;AAED,gBAAIF,WAAWG,OAAf,EAAwB;AACpBJ;AACH,aAFD,MAEK;AACD,uBAAOD,IAAIM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,SAAQ,WAAT,EAArB,CAAP;AACH;AAEJ;;;;;;AAGLC,OAAOC,OAAP,GACIlB,IADJ","file":"validateRole.js","sourcesContent":["const { AccessControl } = require('accesscontrol');\n\nconst grantsObject = require('../app/helper/access_control');\nconst Helper = require('../app/helper/helper');\n\n\nconst helper = new Helper();\nconst ac = new AccessControl(grantsObject);\n\n// const role = helper.getRole(req, res);\n  // const permission = ac.can(role).readAny('document');\n\n  // if (permission.granted) {\n\nclass Role {\n    constructor(){\n        this.role='';\n\n        this.setRole=this.setRole.bind(this);\n        this.validateRole=this.validateRole.bind(this)\n    }\n\n    setRole(req){\n       this.role = helper.getRole(req.roles);\n    }\n\n    validateRole(req, res, next){\n        this.setRole(req);\n\n         const permission = ac.setGrants(this.role).readAny('project-view-contractor');\n\n        if (permission.granted) {\n            next();\n        }else{\n            return res.status(403).json({message:\"Forbidden\"});\n        }\n        \n    }\n}\n\nmodule.exports=\n    Role\n\n"]}