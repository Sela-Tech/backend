{"version":3,"sources":["../../../../config/initializers/mongoose.js"],"names":["mongoose","require","dotenv","config","module","exports","done","console","log","ROOT","Promise","global","connectWithRetry","process","env","NODE_ENV","connect","MONGO_URI_UNIT_TEST","useMongoClient","reconnectTries","connectTimeoutMS","MONGO_URI","connection","on","err"],"mappings":";;AAAA,IAAIA,WAAWC,QAAQ,UAAR,CAAf;AACA,IAAIC,SAAQD,QAAQ,QAAR,CAAZ;;AAEAC,OAAOC,MAAP;AACA;AACA;;AAEAC,OAAOC,OAAP,GAAiB,UAASC,IAAT,EAAe;AAC9BA,SAAO,OAAOA,IAAP,KAAgB,UAAhB,GAA6BA,IAA7B,GAAoC,YAAW,CAAE,CAAxD;;AAEAC,UAAQC,GAAR,CAAY,+BAAZ;;AAEA;;AAEAP,UAAQQ,OAAO,aAAf;;AAEAT,WAASU,OAAT,GAAmBC,OAAOD,OAA1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA,MAAIE,mBAAmB,SAAnBA,gBAAmB,GAAW;AAChC,QAAGC,QAAQC,GAAR,CAAYC,QAAZ,KAAuB,MAA1B,EAAiC;AAC/Bf,eAASgB,OAAT,CACEH,QAAQC,GAAR,CAAYG,mBADd,EAEE;AACEC,wBAAgB,IADlB;AAEEC,wBAAgB,UAFlB;AAGEC,0BAAkB;AAHpB,OAFF;AASD,KAVD,MAUK;AACHpB,eAASgB,OAAT,CACEH,QAAQC,GAAR,CAAYO,SADd,EAEE;AACEH,wBAAgB,IADlB;AAEEC,wBAAgB,UAFlB;AAGEC,0BAAkB;AAHpB,OAFF;AAQD;AACF,GArBD;;AAuBApB,WAASsB,UAAT,CAAoBC,EAApB,CAAuB,OAAvB,EAAgC,UAASC,GAAT,EAAc;AAC5CjB,YAAQC,GAAR,CAAY,qBAAqBgB,GAAjC;AACAZ;AACD,GAHD;;AAKAZ,WAASsB,UAAT,CAAoBC,EAApB,CAAuB,WAAvB,EAAoC,UAASC,GAAT,EAAc;AAChDjB,YAAQC,GAAR,CAAY,wBAAZ;AACAF;AACD,GAHD;;AAKAM;AACD,CA9DD","file":"mongoose.js","sourcesContent":["var mongoose = require(\"mongoose\");\nlet dotenv= require('dotenv');\n\ndotenv.config();\n//Uncomment to turn on debugging\n//mongoose.set('debug', true)\n\nmodule.exports = function(done) {\n  done = typeof done === \"function\" ? done : function() {};\n\n  console.log(\"Initializer: Mongoose started\");\n\n  // the mongoose models and the mongoose connection don't need to happen in order\n\n  require(ROOT + \"/app/models\")();\n\n  mongoose.Promise = global.Promise;\n  // mongoose.connect(\n  //   process.env.MONGO_URI,\n  //   {\n  //     useMongoClient: true,\n  //     reconnectTries: 9999999999,\n  //     connectTimeoutMS: 2000\n  //   }\n  // );\n\n  // mongoose.connection.on(\"error\", function(err) {\n  //   console.log(\"Error MONGOOSE: \" + err);\n  // });\n\n  // mongoose.connection.on(\"connected\", function() {\n  //   done();\n  // });\n\n  \n  var connectWithRetry = function() {\n    if(process.env.NODE_ENV==='test'){\n      mongoose.connect(\n        process.env.MONGO_URI_UNIT_TEST,\n        {\n          useMongoClient: true,\n          reconnectTries: 9999999999,\n          connectTimeoutMS: 2000\n        }\n      );\n\n    }else{\n      mongoose.connect(\n        process.env.MONGO_URI,\n        {\n          useMongoClient: true,\n          reconnectTries: 9999999999,\n          connectTimeoutMS: 2000\n        }\n      );\n    }\n  };\n\n  mongoose.connection.on(\"error\", function(err) {\n    console.log(\"Error MONGOOSE: \" + err);\n    connectWithRetry();\n  });\n\n  mongoose.connection.on(\"connected\", function(err) {\n    console.log(\"Successfully Connected\");\n    done();\n  });\n\n  connectWithRetry();\n};\n"]}